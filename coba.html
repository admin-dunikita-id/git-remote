<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Al-Quran Digital Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Light Mode */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .controls {
            background: #f8f9fa;
            padding: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            position: relative;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        select, button, input {
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select:hover, button:hover, input:focus {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
        }

        .icon-btn {
            width: 50px;
            height: 50px;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            border-radius: 50%;
        }

        /* CSS search history */
        .search-history {
            display: none;
            position: absolute;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-top: 8px;
            z-index: 999;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
        }

        .search-history.show {
            display: block;
        }

        .search-history-header {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .search-history-item {
            padding: 8px;
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.2s ease;
            font-size: 14px;
            color: #333;
            background: #f9f9f9;
            margin-bottom: 5px;
        }

        .search-history-item:hover {
            background: #e0f7fa;
        }

        .search-history-icon {
            margin-right: 6px;
        }

        .search-history-text {
            color: #333;
            flex: 1;
            margin-left: 8px;
        }

        .search-history-delete,
        .search-history-pin {
            background: none;
            border: none;
            font-size: 14px;
            cursor: pointer;
            padding: 2px 5px;
            color: #666;
        }

        .search-history-delete:hover,
        .search-history-pin:hover {
            color: #000;
        }

        .search-history-clear {
            text-align: center;
            margin-top: 10px;
        }

        .clear-history-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
        }

        /* CSS search History Dark mode*/

        body.dark-theme .search-history {
            background: #2c3e50;
            color: white;
        }

        body.dark-theme .search-history-item {
            background: #37474f;
            color: #eee;
        }

        body.dark-theme .search-history-item:hover {
            background: #455a64;
        }

        body.dark-theme .search-history-text {
            color: #fff;
        }

        body.dark-theme .clear-history-btn {
            background: #495057;
        }

        body.dark-theme .search-history-delete,
        body.dark-theme .search-history-pin {
            color: #ccc;
        }

        body.dark-theme .search-history-delete:hover,
        body.dark-theme .search-history-pin:hover {
            color: white;
        }

        .search-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-input {
            position: absolute;
            top: 60px;
            right: 0;
            width: 300px;
            display: none;
            z-index: 100;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .search-input.show {
            display: flex;
            gap: 10px;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .settings-panel {
            position: absolute;
            overflow: auto; /* Menambahkan scrollbar jika konten melebihi tinggi */
            flex-direction: column;
            align-items: flex-start;
            max-height: 500px;
            top: 80px;
            right: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 20px;
            width: 400px;
            display: none;
            z-index: 1000;
            border: 2px solid #667eea;
        }

        .settings-panel.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .settings-panel h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.3rem;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .setting-item2 {
            display: flex;
            align-items: left;
            flex-direction: column; /* Mengatur elemen dalam kolom */
            margin-bottom: 5px;
        }


        .setting-label {
            color: #2c3e50;
            font-weight: 500;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 25px;
            background: #ccc;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: #667eea;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
        }

        .toggle-switch.active::after {
            transform: translateX(25px);
        }

        .font-size-control {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .font-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        .font-btn:hover, .font-btn.active {
            background: #667eea;
            color: white;
        }

        .qari-select {
            width: 100%;
            margin-top: 10px;
        }

        .language-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .lang-btn {
            padding: 6px 12px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .lang-btn:hover, .lang-btn.active {
            background: #667eea;
            color: white;
        }

        /* Tajwid Colors - sesuai standar mushaf */
        .tajwid-mad { 
            background: linear-gradient(to bottom, rgba(255, 0, 255, 0.3), rgba(255, 0, 255, 0.1));
            border-radius: 2px;
            padding: 0 1px;
        }

        .tajwid-ikhfa { 
            background: linear-gradient(to bottom, rgba(0, 255, 0, 0.4), rgba(0, 255, 0, 0.2));
            border-radius: 2px;
            padding: 0 1px;
        }

        .tajwid-idgham { 
            background: linear-gradient(to bottom, rgba(255, 165, 0, 0.4), rgba(255, 165, 0, 0.2));
            border-radius: 2px;
            padding: 0 1px;
        }

        .tajwid-ghunnah { 
            background: linear-gradient(to bottom, rgba(255, 255, 0, 0.4), rgba(255, 255, 0, 0.2));
            border-radius: 2px;
            padding: 0 1px;
        }

        .tajwid-qalqalah { 
            background: linear-gradient(to bottom, rgba(0, 255, 255, 0.4), rgba(0, 255, 255, 0.2));
            border-radius: 2px;
            padding: 0 1px;
        }

        .tajwid-iqlab { 
            background: linear-gradient(to bottom, rgba(255, 192, 203, 0.4), rgba(255, 192, 203, 0.2));
            border-radius: 2px;
            padding: 0 1px;
        }

        .tajwid-waqf { 
            background: linear-gradient(to bottom, rgba(255, 0, 0, 0.3), rgba(255, 0, 0, 0.1));
            border-radius: 2px;
            padding: 0 1px;
        }

        .tajwid-madd-lazim { 
            background: linear-gradient(to bottom, rgba(0, 0, 255, 0.4), rgba(0, 0, 255, 0.2));
            border-radius: 2px;
            padding: 0 1px;
        }

        .tajwid-madd-wajib { 
            background: linear-gradient(to bottom, rgba(128, 0, 128, 0.4), rgba(128, 0, 128, 0.2));
            border-radius: 2px;
            padding: 0 1px;
        }

        /* Dark theme dengan opacity lebih rendah */
        body.dark-theme .tajwid-mad { 
            background: linear-gradient(to bottom, rgba(255, 0, 255, 0.2), rgba(255, 0, 255, 0.05));
        }
        body.dark-theme .tajwid-ikhfa { 
            background: linear-gradient(to bottom, rgba(0, 255, 0, 0.2), rgba(0, 255, 0, 0.05));
        }
        body.dark-theme .tajwid-idgham { 
            background: linear-gradient(to bottom, rgba(255, 165, 0, 0.2), rgba(255, 165, 0, 0.05));
        }
        body.dark-theme .tajwid-ghunnah { 
            background: linear-gradient(to bottom, rgba(255, 255, 0, 0.2), rgba(255, 255, 0, 0.05));
        }
        body.dark-theme .tajwid-qalqalah { 
            background: linear-gradient(to bottom, rgba(0, 255, 255, 0.2), rgba(0, 255, 255, 0.05));
        }
        body.dark-theme .tajwid-iqlab { 
            background: linear-gradient(to bottom, rgba(255, 192, 203, 0.2), rgba(255, 192, 203, 0.05));
        }
        body.dark-theme .tajwid-waqf { 
            background: linear-gradient(to bottom, rgba(255, 0, 0, 0.2), rgba(255, 0, 0, 0.05));
        }
        body.dark-theme .tajwid-madd-lazim { 
            background: linear-gradient(to bottom, rgba(0, 0, 255, 0.2), rgba(0, 0, 255, 0.05));
        }
        body.dark-theme .tajwid-madd-wajib { 
            background: linear-gradient(to bottom, rgba(128, 0, 128, 0.2), rgba(128, 0, 128, 0.05));
        }

        .tajwid-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            margin-top: 10px;
            margin-bottom: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 12px;
        }

        body.dark-theme .tajwid-legend {
            background: transparent;
            color: black;
            border : 2px solid #ddd;
        }

        .tajwid-legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tajwid-color-box {
            width: 20px;
            height: 15px;
            border-radius: 3px;
            border: 1px solid #ddd;
        }

        .audio-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            background: #e8f5e8;
            padding: 15px;
            border-radius: 10px;
            margin: 20px;
        }

        .audio-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .audio-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .audio-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .surah-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            text-align: center;
            margin: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .surah-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .surah-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .surah-container {
            padding: 20px;
        }

        .ayah-card {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 25px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            margin-bottom: 20px;
            background: #fafafa;
            transition: all 0.3s ease;
            position: relative;
        }

        .ayah-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .ayah-card.highlight {
            background: #fff3cd;
            border-color: #ffc107;
            animation: pulse 2s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .left-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ayah-number {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-weight: bold;
            text-align: center;
            width: fit-content;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }

        .verse-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .bookmark-btn.bookmarked {
            background: #ffc107;
            color: #212529;
        }

        .transliteration {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #2196f3;
            display: block;
        }

        .transliteration h4 {
            color: #1976d2;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .transliteration p {
            font-style: italic;
            line-height: 1.5;
            color: #424242;
        }

        .translation {
            background: #f3e5f5;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #9c27b0;
            display: block;
        }

        .translation h4 {
            color: #7b1fa2;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .translation p {
            line-height: 1.6;
            color: #424242;
        }

        .arabic-text {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff8e1;
            padding: 25px;
            border-radius: 10px;
            border-right: 4px solid #ff9800;
        }

        .arabic {
            font-size: 1.8rem;
            line-height: 1.8;
            text-align: right;
            direction: rtl;
            color: #2c3e50;
            font-family: 'Arabic Typesetting', 'Traditional Arabic', serif;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .arabic:hover {
            color: #667eea;
            transform: scale(1.02);
        }

        .arabic.small-text {
            font-size: 1.5rem;
        }

        .arabic.medium-text {
            font-size: 1.8rem;
        }

        .arabic.large-text {
            font-size: 2.2rem;
        }

        .arabic.xlarge-text {
            font-size: 2.8rem;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 1.2rem;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #f44336;
            text-align: center;
            margin: 20px;
        }

        .navigation {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            padding: 20px;
        }

        .nav-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            background: #e9ecef;
            height: 6px;
            border-radius: 3px;
            margin: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(45deg, #667eea, #764ba2);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .statistics {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        /* Dark Theme */
        body.dark-theme {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }

        body.dark-theme .container {
            background: #2c3e50;
            color: white;
        }

        body.dark-theme .controls {
            background: #34495e;
        }

        body.dark-theme .ayah-card {
            background: #34495e;
            border-color: #495057;
            color: white;
        }

        body.dark-theme .transliteration {
            background: #fff;
            color: white;
        }

        body.dark-theme .translation {
            background: #fff;
            color: white;
        }

        body.dark-theme .arabic-text {
            background: #fff;
        }

        body.dark-theme .statistics {
            background: #34495e;
        }

        body.dark-theme .settings-panel {
            background: #ffffff;
            color: white;
        }

        body.dark-theme .setting-item {
            background: #ffffff;
            border : 2px solid #ddd;
        }

        body.dark-theme .audio-controls {
            background: #495057;
        }

        .scroll-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: none;
            font-size: 20px;
        }

        .scroll-top:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        .bookmarks-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .bookmarks-panel.open {
            right: 0;
        }

        body.dark-theme .bookmarks-panel {
            background: #2c3e50;
            color: white;
        }

        .bookmarks-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-bookmarks {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .bookmark-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .bookmark-item:hover {
            background: #f8f9fa;
        }

        body.dark-theme .bookmark-item {
            border-bottom-color: #495057;
        }

        body.dark-theme .bookmark-item:hover {
            background: #495057;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        @media (max-width: 768px) {
            .ayah-card {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 20px;
            }
            
            .arabic {
                font-size: 1.5rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .surah-header h2 {
                font-size: 1.5rem;
            }

            .bookmarks-panel {
                width: 100%;
                right: -100%;
            }

            .settings-panel {
                width: 300px;
                right: 10px;
            }

            .search-input {
                width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="overlay" id="overlay" onclick="closeAllPanels()"></div>
    
    <div class="container">
        <div class="header">
            <button class="theme-toggle" onclick="toggleTheme()" title="Ubah Tema Gelap">ğŸŒ™</button>
            <h1>ğŸ“– Al-Quran Digital Enhanced</h1>
            <p>Membaca Al-Quran dengan mudah dan nyaman</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="surah">Pilih Surah:</label>
                <select id="surah">
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            
            <!-- Contoh implementasi HTML yang diperbarui -->
            <div class="search-container">
                <button class="icon-btn" onclick="toggleSearch()" title="Cari Ayat">ğŸ”</button>
                <div class="search-input" id="searchContainer">
                    <div class="search-input-wrapper">
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="searchInput" placeholder="Cari ayat..." />
                            <button onclick="searchVerse()">Cari</button>
                        </div>
                        <!-- Riwayat pencarian -->
                        <div class="search-history" id="searchHistory">
                            <div class="search-history-header">
                                ğŸ“š Riwayat Pencarian
                            </div>
                            <div id="searchHistoryList">
                                <!-- Items akan diisi oleh JavaScript -->
                            </div>
                            <div class="search-history-clear">
                                <button class="clear-history-btn" onclick="clearSearchHistory()">
                                    ğŸ—‘ï¸ Hapus Semua Riwayat
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="loadSurahBtn">ğŸ“– Tampilkan Surah</button>
            <button onclick="toggleBookmarks()">ğŸ”– Bookmark</button>
            <button class="icon-btn" onclick="toggleSettings()" title="Pengaturan">âš™ï¸</button>
            
            <!-- Settings Panel -->
            <div class="settings-panel" id="settingsPanel">
                <h3>âš™ï¸ Pengaturan</h3>
                
                <div class="setting-item2">
                    <span class="setting-label">Ukuran Font Arab</span>
                </div>
                <div class="setting-item">
                    <div class="font-size-control">
                        <button class="font-btn" onclick="setFontSize('small')" title="Kecil">A</button>
                        <button class="font-btn active" onclick="setFontSize('medium')" title="Sedang">A</button>
                        <button class="font-btn" onclick="setFontSize('large')" title="Besar">A</button>
                        <button class="font-btn" onclick="setFontSize('xlarge')" title="Sangat Besar">A</button>
                    </div>
                </div>

                <div class="setting-item">
                    <span class="setting-label">Tampilkan Tajwid</span>
                    <div class="toggle-switch" onclick="toggleTajwid()" id="tajwidToggle"></div>
                </div>
                
                <div class="tajwid-legend" id="tajwidLegend" style="display: none;">
                    <div class="tajwid-legend-item">
                        <div class="tajwid-color-box tajwid-ghunnah"></div>
                        <span>Ghunnah</span>
                    </div>
                    <div class="tajwid-legend-item">
                        <div class="tajwid-color-box tajwid-idgham"></div>
                        <span>Idgham</span>
                    </div>
                    <div class="tajwid-legend-item">
                        <div class="tajwid-color-box tajwid-ikhfa"></div>
                        <span>Ikhfa</span>
                    </div>
                    <div class="tajwid-legend-item">
                        <div class="tajwid-color-box tajwid-iqlab"></div>
                        <span>Iqlab</span>
                    </div>
                    <div class="tajwid-legend-item">
                        <div class="tajwid-color-box tajwid-mad"></div>
                        <span>Mad Thabi'i</span>
                    </div>
                    <div class="tajwid-legend-item">
                        <div class="tajwid-color-box tajwid-qalqalah"></div>
                        <span>Qalqalah</span>
                    </div>
                    <div class="tajwid-legend-item">
                        <div class="tajwid-color-box tajwid-waqf"></div>
                        <span>Waqf</span>
                    </div>
                    <div class="tajwid-legend-item">
                        <div class="tajwid-color-box tajwid-madd-lazim"></div>
                        <span>Mad Lazim</span>
                    </div>
                    <div class="tajwid-legend-item">
                        <div class="tajwid-color-box tajwid-madd-wajib"></div>
                        <span>Mad Wajib</span>
                    </div>
                </div>
                

                <div class="setting-item">
                    <span class="setting-label">Tampilkan Transliterasi</span>
                    <div class="toggle-switch active" onclick="toggleTransliteration()" id="transliterationToggle"></div>
                </div>

                <div class="setting-item">
                    <span class="setting-label">Tampilkan Terjemahan</span>
                    <div class="toggle-switch active" onclick="toggleTranslation()" id="translationToggle"></div>
                </div>

                <div class="setting-item2">
                    <span class="setting-label">Pilih Bahasa Terjemah</span>
                </div>
                <div class="setting-item">
                    <div class="language-selector">
                        <button class="lang-btn active" onclick="setLanguage('id')">ID</button>
                        <button class="lang-btn" onclick="setLanguage('en')">EN</button>
                        <button class="lang-btn" onclick="setLanguage('my')">MY</button>
                        <button class="lang-btn" onclick="setLanguage('fr')">FR</button>
                        <button class="lang-btn" onclick="setLanguage('de')">DE</button>
                        <button class="lang-btn" onclick="setLanguage('tr')">TR</button>
                    </div>
                </div>

        
                <div class="setting-item2">
                    <span class="setting-label">Pilih Qari</span>
                </div>
                <div class="setting-item">
                    <select class="qari-select" id="qariSelect">
                        <option value="abdul-basit">Abdul Basit</option>
                        <option value="al-husary">Al Husary</option>
                        <option value="al-minshawi">Al Minshawi Mujawwad</option>
                        <option value="al-huzaifi">Ali bin Abdurrahman al-Huzaifi</option>
                        <option value="aziz-alili">Aziz Alili</option>
                        <option value="mishari-alafasy">Mishari Alafasy</option>
                        <option value="saad-al-ghamidi">Saad Al Ghamidi</option>
                        <option value="saud-ash-shuraym">Saud Ash-Shuraym</option>
                    </select>
                </div>

            </div>
        </div>

        <div class="audio-controls">
            <button class="audio-btn" onclick="playAudio()" id="playAudioBtn" disabled>â–¶ï¸ Putar Audio</button>
            <button class="audio-btn" onclick="pauseAudio()">â¸ï¸ Jeda</button>
            <button class="audio-btn" onclick="stopAudio()">â¹ï¸ Stop</button>
            <span>ğŸ”Š Audio tersedia untuk Al-Fatihah</span>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="statistics" id="statistics">
            <div class="stat-item">
                <div class="stat-number" id="totalAyahs">0</div>
                <div class="stat-label">Total Ayat</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="readingProgress">0%</div>
                <div class="stat-label">Progress Baca</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="bookmarkCount">0</div>
                <div class="stat-label">Bookmark</div>
            </div>
        </div>
        <div class="navigation">
            <button class="nav-btn" onclick="previousSurah()" id="prevBtn">â† Surah Sebelumnya</button>
            <button class="nav-btn" onclick="nextSurah()" id="nextBtn">Surah Selanjutnya â†’</button>
        </div>

        <div class="surah-container" id="surahContainer">
            <div class="loading">Pilih surah untuk mulai membaca</div>
        </div>

    
    </div>

    <button class="scroll-top" onclick="scrollToTop()" id="scrollTopBtn">â†‘</button>

    <!-- Bookmarks Panel -->
    <div class="bookmarks-panel" id="bookmarksPanel">
        <div class="bookmarks-header">
            <h3>ğŸ“š Bookmark Ayat</h3>
            <button class="close-bookmarks" onclick="toggleBookmarks()">Ã—</button>
        </div>
        <div id="bookmarksList">
            <div style="padding: 20px; text-align: center; color: #666;">
                Belum ada bookmark
            </div>
        </div>
    </div>

    <script>
        // Enhanced Quran data with more surahs
        const tajwidData = {
            1: { // Al-Fatihah
                1: {
                    tajwid: "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…Ù<span class='tajwid-mad'>Ù°</span>Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù"
                },
                2: {
                    tajwid: "Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„Ù„ÙÙ‘Ù‡Ù Ø±ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø¹Ù<span class='tajwid-mad'>Ø§</span>Ù„ÙÙ…Ù<span class='tajwid-mad'>ÙŠ</span>Ù†Ù"
                },
                3: {
                    tajwid: "Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…Ù<span class='tajwid-mad'>Ù°</span>Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù<span class='tajwid-mad'>ÙŠ</span>Ù…Ù"
                },
                4: {
                    tajwid: "Ù…Ù<span class='tajwid-mad'>Ø§</span>Ù„ÙÙƒÙ ÙŠÙÙˆÙ’Ù…Ù Ø§Ù„Ø¯ÙÙ‘<span class='tajwid-mad'>ÙŠ</span>Ù†Ù"
                },
                5: {
                    tajwid: "Ø¥ÙÙŠÙÙ‘<span class='tajwid-mad'>Ø§</span>ÙƒÙ Ù†ÙØ¹Ù’Ø¨ÙØ¯Ù ÙˆÙØ¥ÙÙŠÙÙ‘<span class='tajwid-mad'>Ø§</span>ÙƒÙ Ù†ÙØ³Ù’ØªÙØ¹Ù<span class='tajwid-mad'>ÙŠ</span>Ù†Ù"
                },
                6: {
                    tajwid: "Ø§Ù‡Ù’Ø¯ÙÙ†ÙØ§ Ø§Ù„ØµÙÙ‘Ø±Ù<span class='tajwid-mad'>Ø§</span>Ø·Ù Ø§Ù„Ù’Ù…ÙØ³Ù’ØªÙÙ‚Ù<span class='tajwid-mad'>ÙŠ</span>Ù…Ù"
                },
                7: {
                    tajwid: "ØµÙØ±Ù<span class='tajwid-mad'>Ø§</span>Ø·Ù Ø§Ù„ÙÙ‘Ø°Ù<span class='tajwid-mad'>ÙŠ</span>Ù†Ù Ø£Ù<span class='tajwid-ikhfa'>Ù†Ù’</span>Ø¹ÙÙ…Ù’ØªÙ Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ØºÙÙŠÙ’<span class='tajwid-mad'>Ø±</span> Ø§Ù„Ù’Ù…ÙØºÙ’Ø¶Ù<span class='tajwid-mad'>Ùˆ</span>Ø¨Ù Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ÙˆÙÙ„ÙØ§ Ø§Ù„Ø¶ÙÙ‘<span class='tajwid-mad'>Ø§</span>Ù„ÙÙ‘<span class='tajwid-mad'>ÙŠ</span>Ù†Ù"
                }
            },
            2: { // Al-Baqarah
                1: {
                    tajwid: "Ø§Ù„Ù…"
                },
                2: {
                    tajwid: "Ø°Ù<span class='tajwid-mad'>Ù°</span>Ù„ÙÙƒÙ Ø§Ù„Ù’ÙƒÙØªÙ<span class='tajwid-mad'>Ø§</span>Ø¨Ù Ù„ÙØ§ Ø±ÙÙŠÙ’Ø¨Ù Û› ÙÙ<span class='tajwid-mad'>ÙŠ</span>Ù‡Ù Û› Ù‡ÙØ¯Ù‹Ù‰ Ù„ÙÙ‘Ù„Ù’Ù…ÙØªÙÙ‘Ù‚Ù<span class='tajwid-mad'>ÙŠ</span>Ù†Ù"
                },
                3: {
                    tajwid: "Ø§Ù„ÙÙ‘Ø°Ù<span class='tajwid-mad'>ÙŠ</span>Ù†Ù ÙŠÙØ¤Ù’Ù…ÙÙ†Ù<span class='tajwid-mad'>Ùˆ</span>Ù†Ù Ø¨ÙØ§Ù„Ù’ØºÙÙŠÙ’Ø¨Ù ÙˆÙÙŠÙÙ‚Ù<span class='tajwid-mad'>ÙŠ</span>Ù…Ù<span class='tajwid-mad'>Ùˆ</span>Ù†Ù Ø§Ù„ØµÙÙ‘Ù„Ù<span class='tajwid-mad'>Ø§</span>Ø©Ù ÙˆÙÙ…ÙÙ…ÙÙ‘Ø§ Ø±ÙØ²ÙÙ‚Ù’Ù†Ù<span class='tajwid-mad'>Ø§</span>Ù‡ÙÙ…Ù’ ÙŠÙÙ†ÙÙÙ‚Ù<span class='tajwid-mad'>Ùˆ</span>Ù†Ù"
                }
            }
        };

        const quranData = {
            1: {
                name: "Al-Fatihah",
                arabicName: "Ø§Ù„ÙØ§ØªØ­Ø©",
                meaning: "Pembukaan",
                revelation: "Makkah",
                verses: {
                    1: {
                        arabic: "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù",
                        transliteration: "BismillÄhi'r-raá¸¥mÄni'r-raá¸¥Ä«m",
                        translation: "Dengan menyebut nama Allah Yang Maha Pemurah lagi Maha Penyayang."
                    },
                    2: {
                        arabic: "Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø±ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…ÙÙŠÙ†Ù",
                        transliteration: "Al-á¸¥amdu lillÄhi rabbi'l-'ÄlamÄ«n",
                        translation: "Segala puji bagi Allah, Tuhan semesta alam."
                    },
                    3: {
                        arabic: "Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù",
                        transliteration: "Ar-raá¸¥mÄni'r-raá¸¥Ä«m", 
                        translation: "Maha Pemurah lagi Maha Penyayang."
                    },
                    4: {
                        arabic: "Ù…ÙØ§Ù„ÙÙƒÙ ÙŠÙÙˆÙ’Ù…Ù Ø§Ù„Ø¯ÙÙ‘ÙŠÙ†Ù",
                        transliteration: "MÄliki yawmi'd-dÄ«n",
                        translation: "Yang menguasai di Hari Pembalasan."
                    },
                    5: {
                        arabic: "Ø¥ÙÙŠÙÙ‘Ø§ÙƒÙ Ù†ÙØ¹Ù’Ø¨ÙØ¯Ù ÙˆÙØ¥ÙÙŠÙÙ‘Ø§ÙƒÙ Ù†ÙØ³Ù’ØªÙØ¹ÙÙŠÙ†Ù",
                        transliteration: "IyyÄka na'budu wa iyyÄka nasta'Ä«n",
                        translation: "Hanya kepada Engkaulah kami menyembah dan hanya kepada Engkaulah kami meminta pertolongan."
                    },
                    6: {
                        arabic: "Ø§Ù‡Ù’Ø¯ÙÙ†ÙØ§ Ø§Ù„ØµÙÙ‘Ø±ÙØ§Ø·Ù Ø§Ù„Ù’Ù…ÙØ³Ù’ØªÙÙ‚ÙÙŠÙ…Ù",
                        transliteration: "Ihdinaá¹£-á¹£irÄá¹­al-mustaqÄ«m",
                        translation: "Tunjukilah kami jalan yang lurus."
                    },
                    7: {
                        arabic: "ØµÙØ±ÙØ§Ø·Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø£ÙÙ†Ù’Ø¹ÙÙ…Ù’ØªÙ Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ØºÙÙŠÙ’Ø±Ù Ø§Ù„Ù’Ù…ÙØºÙ’Ø¶ÙÙˆØ¨Ù Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ÙˆÙÙ„ÙØ§ Ø§Ù„Ø¶ÙÙ‘Ø§Ù„ÙÙ‘ÙŠÙ†Ù",
                        transliteration: "á¹¢irÄá¹­al-ladhÄ«na an'amta 'alayhim ghayril-maghá¸Å«bi 'alayhim wa laá¸-á¸ÄllÄ«n",
                        translation: "(Yaitu) jalan orang-orang yang telah Engkau beri nikmat kepada mereka; bukan (jalan) mereka yang dimurkai dan bukan (pula jalan) mereka yang sesat."
                    }
                }
            },
            2: {
                name: "Al-Baqarah",
                arabicName: "Ø§Ù„Ø¨Ù‚Ø±Ø©",
                meaning: "Sapi Betina",
                revelation: "Madinah",
                verses: {
                    1: {
                        arabic: "Ø§Ù„Ù…",
                        transliteration: "Alif LÄm MÄ«m",
                        translation: "Alif Laam Miim."
                    },
                    2: {
                        arabic: "Ø°ÙÙ°Ù„ÙÙƒÙ Ø§Ù„Ù’ÙƒÙØªÙØ§Ø¨Ù Ù„ÙØ§ Ø±ÙÙŠÙ’Ø¨Ù Û› ÙÙÙŠÙ‡Ù Û› Ù‡ÙØ¯Ù‹Ù‰ Ù„ÙÙ‘Ù„Ù’Ù…ÙØªÙÙ‘Ù‚ÙÙŠÙ†Ù",
                        transliteration: "DhÄlika al-kitÄbu lÄ rayba fÄ«hi hudal lil-muttaqÄ«n",
                        translation: "Kitab (Al Quran) ini tidak ada keraguan padanya; petunjuk bagi mereka yang bertakwa."
                    },
                    3: {
                        arabic: "Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù ÙŠÙØ¤Ù’Ù…ÙÙ†ÙÙˆÙ†Ù Ø¨ÙØ§Ù„Ù’ØºÙÙŠÙ’Ø¨Ù ÙˆÙÙŠÙÙ‚ÙÙŠÙ…ÙÙˆÙ†Ù Ø§Ù„ØµÙÙ‘Ù„ÙØ§Ø©Ù ÙˆÙÙ…ÙÙ…ÙÙ‘Ø§ Ø±ÙØ²ÙÙ‚Ù’Ù†ÙØ§Ù‡ÙÙ…Ù’ ÙŠÙÙ†ÙÙÙ‚ÙÙˆÙ†Ù",
                        transliteration: "AlladhÄ«na yu'minÅ«na bil-ghaybi wa yuqÄ«mÅ«naá¹£-á¹£alÄta wa mimmÄ razaqnÄhum yunfiqÅ«n",
                        translation: "(yaitu) mereka yang beriman kepada yang ghaib, yang mendirikan shalat, dan menafkahkan sebahagian rezeki yang Kami anugerahkan kepada mereka."
                    },
                    4: {
                        arabic: "ÙˆÙØ§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù ÙŠÙØ¤Ù’Ù…ÙÙ†ÙÙˆÙ†Ù Ø¨ÙÙ…ÙØ§ Ø£ÙÙ†Ø²ÙÙ„Ù Ø¥ÙÙ„ÙÙŠÙ’ÙƒÙ ÙˆÙÙ…ÙØ§ Ø£ÙÙ†Ø²ÙÙ„Ù Ù…ÙÙ† Ù‚ÙØ¨Ù’Ù„ÙÙƒÙ ÙˆÙØ¨ÙØ§Ù„Ù’Ø¢Ø®ÙØ±ÙØ©Ù Ù‡ÙÙ…Ù’ ÙŠÙÙˆÙ‚ÙÙ†ÙÙˆÙ†Ù",
                        transliteration: "Wa alladhÄ«na yu'minÅ«na bimÄ unzila ilayka wa mÄ unzila min qablika wa bil-Äkhirati hum yÅ«qinÅ«n",
                        translation: "Dan mereka yang beriman kepada kitab (Al Quran) yang telah diturunkan kepadamu dan kitab-kitab yang telah diturunkan sebelummu, serta mereka yakin akan adanya (kehidupan) akhirat."
                    },
                    5: {
                        arabic: "Ø£ÙÙˆÙ„ÙÙ°Ø¦ÙÙƒÙ Ø¹ÙÙ„ÙÙ‰Ù° Ù‡ÙØ¯Ù‹Ù‰ Ù…ÙÙ‘Ù† Ø±ÙÙ‘Ø¨ÙÙ‘Ù‡ÙÙ…Ù’ Û– ÙˆÙØ£ÙÙˆÙ„ÙÙ°Ø¦ÙÙƒÙ Ù‡ÙÙ…Ù Ø§Ù„Ù’Ù…ÙÙÙ’Ù„ÙØ­ÙÙˆÙ†Ù",
                        transliteration: "UlÄ'ika 'alÄ hudal mir rabbihim wa ulÄ'ika humul muflihÅ«n",
                        translation: "Mereka itulah yang tetap mendapat petunjuk dari Tuhan mereka, dan merekalah orang-orang yang beruntung."
                    }
                }
            },
            3: {
                name: "Ali 'Imran",
                arabicName: "Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†",
                meaning: "Keluarga Imran",
                revelation: "Madinah",
                verses: {
                    1: {
                        arabic: "Ø§Ù„Ù…",
                        transliteration: "Alif LÄm MÄ«m",
                        translation: "Alif Laam Miim."
                    },
                    2: {
                        arabic: "Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù„ÙØ§ Ø¥ÙÙ„ÙÙ°Ù‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø­ÙÙŠÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙŠÙÙ‘ÙˆÙ…Ù",
                        transliteration: "AllÄhu lÄ ilÄha illÄ huwal-á¸¥ayy ul-qayyÅ«m",
                        translation: "Allah, tidak ada Tuhan selain Dia Yang Hidup kekal lagi terus menerus mengurus (makhluk-Nya)."
                    },
                    3: {
                        arabic: "Ù†ÙØ²ÙÙ‘Ù„Ù Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙ Ø§Ù„Ù’ÙƒÙØªÙØ§Ø¨Ù Ø¨ÙØ§Ù„Ù’Ø­ÙÙ‚ÙÙ‘ Ù…ÙØµÙØ¯ÙÙ‘Ù‚Ù‹Ø§ Ù„ÙÙ‘Ù…ÙØ§ Ø¨ÙÙŠÙ’Ù†Ù ÙŠÙØ¯ÙÙŠÙ’Ù‡Ù ÙˆÙØ£ÙÙ†Ø²ÙÙ„Ù Ø§Ù„ØªÙÙ‘ÙˆÙ’Ø±ÙØ§Ø©Ù ÙˆÙØ§Ù„Ù’Ø¥ÙÙ†Ø¬ÙÙŠÙ„Ù",
                        transliteration: "Nazzala 'alaykal kitÄba bil haqqi muá¹£addiqal limÄ bayna yadayhi wa anzalat tawrÄta wal injÄ«l",
                        translation: "Dia menurunkan Al Kitab (Al Quran) kepadamu dengan sebenarnya; membenarkan kitab yang telah diturunkan sebelumnya dan menurunkan Taurat dan Injil."
                    }
                }
            },
            4: {
                name: "An-Nisa",
                arabicName: "Ø§Ù„Ù†Ø³Ø§Ø¡",
                meaning: "Wanita",
                revelation: "Madinah",
                verses: {
                    1: {
                        arabic: "ÙŠÙØ§ Ø£ÙÙŠÙÙ‘Ù‡ÙØ§ Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù Ø§ØªÙÙ‘Ù‚ÙÙˆØ§ Ø±ÙØ¨ÙÙ‘ÙƒÙÙ…Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠ Ø®ÙÙ„ÙÙ‚ÙÙƒÙÙ… Ù…ÙÙ‘Ù† Ù†ÙÙ‘ÙÙ’Ø³Ù ÙˆÙØ§Ø­ÙØ¯ÙØ©Ù",
                        transliteration: "YÄ ayyuhan nÄsuttaqÅ« rabbakumul ladhÄ« khalaqakum min nafsiw wÄhidah",
                        translation: "Hai sekalian manusia, bertakwalah kepada Tuhan-mu yang telah menciptakan kamu dari seorang diri."
                    }
                }
            },
            5: {
                name: "Al-Ma'idah",
                arabicName: "Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©",
                meaning: "Hidangan",
                revelation: "Madinah",
                verses: {
                    1: {
                        arabic: "ÙŠÙØ§ Ø£ÙÙŠÙÙ‘Ù‡ÙØ§ Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø¢Ù…ÙÙ†ÙÙˆØ§ Ø£ÙÙˆÙ’ÙÙÙˆØ§ Ø¨ÙØ§Ù„Ù’Ø¹ÙÙ‚ÙÙˆØ¯Ù",
                        transliteration: "YÄ ayyuhal ladhÄ«na ÄmanÅ« awfÅ« bil 'uqÅ«d",
                        translation: "Hai orang-orang yang beriman, penuhilah aqad-aqad itu."
                    }
                }
            }
        };

        // Global state
        let currentSurah = 1;
        let currentSettings = {
            fontSize: 'medium',
            showTransliteration: true,
            showTranslation: true,
            showTajwid: false,  // TAMBAHAN BARU
            language: 'id',
            qari: 'abdul-basit',
            darkTheme: false
        };
        let bookmarks = [];
        let currentAudio = null;
        let searchResults = [];
        let autoPlayQueue = [];
        let currentAutoIndex = 0;
        let searchHistory = [];

        // search History 

        function loadSearchHistory() {
            const saved = localStorage.getItem('quranSearchHistory');
            try {
                const parsed = JSON.parse(saved);
                searchHistory = Array.isArray(parsed)
                    ? parsed.map(item => typeof item === 'string' ? { text: item, pinned: false } : item)
                    : [];
            } catch {
                searchHistory = [];
            }
            renderSearchHistory();
        }

        function addToSearchHistory(query) {
            if (!query) return;

            // Pastikan tidak duplikat
            const existingIndex = searchHistory.findIndex(item => item.text === query);
            if (existingIndex !== -1) {
                const existingItem = searchHistory.splice(existingIndex, 1)[0];
                searchHistory.unshift(existingItem); // Pindahkan ke atas
            } else {
                searchHistory.unshift({ text: query, pinned: false });
            }

            // Batasi riwayat (maks. 10 tanpa memotong pinned)
            const pinned = searchHistory.filter(h => h.pinned);
            const nonPinned = searchHistory.filter(h => !h.pinned).slice(0, 10 - pinned.length);
            searchHistory = [...pinned, ...nonPinned];

            localStorage.setItem('quranSearchHistory', JSON.stringify(searchHistory));
            renderSearchHistory();
        }

        function renderSearchHistory() {
            const container = document.getElementById('searchHistoryList');
            if (!container) return;
            container.innerHTML = '';

            if (!searchHistory.length) {
                container.innerHTML = '<div style="padding: 10px; color: #666; text-align: center;">Belum ada riwayat</div>';
                return;
            }

            const sorted = [...searchHistory].sort((a, b) => (b.pinned ? 1 : 0) - (a.pinned ? 1 : 0));

            sorted.forEach((item, idx) => {
                const div = document.createElement('div');
                div.className = 'search-history-item';

                const icon = document.createElement('span');
                icon.className = 'search-history-icon';
                icon.textContent = 'ğŸ•“';

                const text = document.createElement('span');
                text.className = 'search-history-text';
                text.textContent = item.text || '';
                div.onclick = () => {
                document.getElementById('searchInput').value = item.text;
                searchVerse();
                document.getElementById('searchContainer').classList.remove('show');
                document.getElementById('searchHistory').classList.remove('show');
            };

                const actions = document.createElement('span');
                actions.style.display = 'flex';
                actions.style.gap = '5px';

                const pinBtn = document.createElement('button');
                pinBtn.className = 'search-history-pin';
                pinBtn.textContent = item.pinned ? 'ğŸ“Œ' : 'ğŸ“';
                pinBtn.title = item.pinned ? 'Unpin dari atas' : 'Pin ke atas';
                pinBtn.onclick = (e) => {
                    e.stopPropagation();
                    const actualItem = searchHistory.find(h => h.text === item.text);
                    if (actualItem) {
                        actualItem.pinned = !actualItem.pinned;
                        localStorage.setItem('quranSearchHistory', JSON.stringify(searchHistory));
                        renderSearchHistory();
                        document.getElementById('searchContainer').classList.remove('show');
                        document.getElementById('searchHistory').classList.remove('show');
                    }
                };

                const delBtn = document.createElement('button');
                delBtn.className = 'search-history-delete';
                delBtn.textContent = 'âŒ';
                delBtn.onclick = (e) => {
                    e.stopPropagation();
                    searchHistory = searchHistory.filter(h => h.text !== item.text);
                    localStorage.setItem('quranSearchHistory', JSON.stringify(searchHistory));
                    renderSearchHistory();
                    document.getElementById('searchContainer').classList.remove('show');
                    document.getElementById('searchHistory').classList.remove('show');
                };

                actions.appendChild(pinBtn);
                actions.appendChild(delBtn);

                div.appendChild(icon);
                div.appendChild(text);
                div.appendChild(actions);
                container.appendChild(div);
            });
        }


        function clearSearchHistory() {
            localStorage.removeItem('quranSearchHistory');
            searchHistory = [];
            renderSearchHistory();
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadSearchHistory();

            const input = document.getElementById('searchInput');
            const historyPanel = document.getElementById('searchHistory');

            if (input && historyPanel) {
                input.addEventListener('focus', () => {
                    renderSearchHistory();
                    historyPanel.classList.add('show');
                });

                input.addEventListener('blur', () => {
                    setTimeout(() => historyPanel.classList.remove('show'), 150);
                });
            }

            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    document.getElementById('searchContainer').classList.remove('show');
                }
            });
        });


        

        // Initialize bookmarks from localStorage
        function initBookmarks() {
            try {
                const saved = localStorage.getItem('quranBookmarks');
                bookmarks = saved ? JSON.parse(saved) : [];
            } catch (error) {
                console.error('Error loading bookmarks:', error);
                bookmarks = [];
            }
        }

        function updateBookmarkCount() {
            try {
                const countElement = document.getElementById('bookmarkCount');
                if (countElement) {
                    countElement.textContent = bookmarks.length;
                }
            } catch (error) {
                console.error('Error updating bookmark count:', error);
            }
        }

        function showError(message) {
            try {
                const container = document.getElementById('surahContainer');
                if (container) {
                    container.innerHTML = `
                        <div class="error">
                            âŒ ${message}
                        </div>
                    `;
                }
                console.error('Error:', message);
            } catch (error) {
                console.error('Error showing error message:', error);
            }
        }

        function showNotification(message) {
            try {
                // Remove existing notifications
                const existing = document.querySelectorAll('.notification');
                existing.forEach(n => n.remove());

                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #4caf50;
                    color: white;
                    padding: 15px 20px;
                    border-radius: 10px;
                    z-index: 9999;
                    animation: slideInRight 0.3s ease;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                `;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 3000);
                
                console.log('Notification:', message);
            } catch (error) {
                console.error('Error showing notification:', error);
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing app...');
            initBookmarks();
            loadSettings();
            updateBookmarkCount();
            populateSurahSelect();
            setupScrollHandler();
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Surah selection change handler
            const surahSelect = document.getElementById('surah');
            if (surahSelect) {
                surahSelect.addEventListener('change', function() {
                    console.log('Surah changed to:', this.value);
                    // Auto-load when selection changes (optional)
                    // currentSurah = parseInt(this.value);
                    // loadSurah();
                });
            }

            // Load surah button
            const loadBtn = document.getElementById('loadSurahBtn');
            if (loadBtn) {
                loadBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Load button clicked');
                    loadSurah();
                });
            }

            // Search input enter key
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                // Event untuk Enter key (yang sudah ada)
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchVerse();
                    }
                });
                
                // Tambahkan event untuk real-time search
                //searchInput.addEventListener('input', function(e) {
                //    const query = e.target.value.trim();
                //    if (query.length >= 3) { // Mulai cari setelah 3 karakter
                //        searchVerse();
                //    } else if (query.length === 0) {
                //        // Kosongkan hasil pencarian jika input kosong
                //        document.getElementById('surahContainer').innerHTML = '<div class="loading">Pilih surah untuk mulai membaca</div>';
                //    }
                //});
            }

            // Tutup kolom pencarian jika klik di luar
            document.addEventListener('click', function (e) {
                const searchContainer = document.getElementById('searchContainer');
                const searchBtn = document.querySelector('.search-container button');
                if (!searchContainer.contains(e.target) && !searchBtn.contains(e.target)) {
                    searchContainer.classList.remove('show');
                    document.getElementById('searchInput').value = ''; // kosongkan input
                }
            });
        }

        // Load saved settings
        function loadSettings() {
            try {
                const saved = localStorage.getItem('quranSettings');
                if (saved) {
                    currentSettings = { ...currentSettings, ...JSON.parse(saved) };
                    applySettings();
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        // Save settings to localStorage
        function saveSettings() {
            try {
                localStorage.setItem('quranSettings', JSON.stringify(currentSettings));
            } catch (error) {
                console.error('Error saving settings:', error);
            }
        }

        // Apply settings to UI
        function applySettings() {
            try {
                // Apply theme
                if (currentSettings.darkTheme) {
                    document.body.classList.add('dark-theme');
                    const themeBtn = document.querySelector('.theme-toggle');
                    if (themeBtn) themeBtn.textContent = 'â˜€ï¸';
                }

                // Apply font size
                document.querySelectorAll('.arabic').forEach(el => {
                    el.className = el.className.replace(/\b(small|medium|large|xlarge)-text\b/, '');
                    el.classList.add(currentSettings.fontSize + '-text');
                });

                // Update toggles
                const transliterationToggle = document.getElementById('transliterationToggle');
                const translationToggle = document.getElementById('translationToggle');
                
                if (transliterationToggle) {
                    transliterationToggle.classList.toggle('active', currentSettings.showTransliteration);
                }
                if (translationToggle) {
                    translationToggle.classList.toggle('active', currentSettings.showTranslation);
                }

                // Update font buttons
                document.querySelectorAll('.font-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                const activeFontBtn = document.querySelector(`[onclick="setFontSize('${currentSettings.fontSize}')"]`);
                if (activeFontBtn) activeFontBtn.classList.add('active');

                // Update language buttons
                document.querySelectorAll('.lang-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                const activeLangBtn = document.querySelector(`[onclick="setLanguage('${currentSettings.language}')"]`);
                if (activeLangBtn) activeLangBtn.classList.add('active');

                // Update qari select
                const qariSelect = document.getElementById('qariSelect');
                if (qariSelect) qariSelect.value = currentSettings.qari;
            } catch (error) {
                console.error('Error applying settings:', error);
            }
        }

        // Toggle tajwid
        function toggleTajwid() {
            currentSettings.showTajwid = !currentSettings.showTajwid;
            const toggle = document.getElementById('tajwidToggle');
            const legend = document.getElementById('tajwidLegend');
            
            toggle.classList.toggle('active');
            legend.style.display = currentSettings.showTajwid ? 'grid' : 'none';
            
            // Update tampilan ayat jika ada surah yang sedang ditampilkan
            updateArabicTextDisplay();
            saveSettings();
        }

        // Update tampilan teks Arab dengan/tanpa tajwid
        function updateArabicTextDisplay() {
            document.querySelectorAll('.arabic').forEach(el => {
                const surahNum = el.getAttribute('data-surah');
                const verseNum = el.getAttribute('data-verse');
                
                if (surahNum && verseNum) {
                    if (currentSettings.showTajwid && tajwidData[surahNum] && tajwidData[surahNum][verseNum]) {
                        // Tampilkan dengan warna tajwid
                        el.innerHTML = tajwidData[surahNum][verseNum].tajwid;
                    } else {
                        // Tampilkan teks Arab biasa
                        el.innerHTML = quranData[surahNum].verses[verseNum].arabic;
                    }
                }
            });
        }

        // fungsi get Arabic Text tajwid
        function getArabicText(surahNum, verseNum) {
                if (currentSettings.showTajwid && tajwidData[surahNum] && tajwidData[surahNum][verseNum]) {
                    return tajwidData[surahNum][verseNum].tajwid;
                }
                return quranData[surahNum].verses[verseNum].arabic;
            }

        // Populate surah select
        function populateSurahSelect() {
            try {
                const select = document.getElementById('surah');
                        select.addEventListener('change', function() {
                        // Kode yang akan dijalankan setiap kali pilihan surah berubah
                    });
                        if (!select) {
                    console.error('Surah select element not found');
                    return;
                }
                
                select.innerHTML = '';
                
                // Add default option
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'Pilih Surah...';
                select.appendChild(defaultOption);
                
                // Add surah options
                Object.keys(quranData).forEach(num => {
                    const surah = quranData[num];
                    const option = document.createElement('option');
                    option.value = num;
                    option.textContent = `${num}. ${surah.name} (${surah.arabicName})`;
                    select.appendChild(option);
                });
                
                console.log('Surah select populated with', Object.keys(quranData).length, 'surahs');
                updateNavigationButtons(); // Tambahkan baris ini!
            } catch (error) {
                console.error('Error populating surah select:', error);
            }
        }

        // Load surah
        function loadSurah() {
            try {
                const surahSelect = document.getElementById('surah');
                const surahNumber = parseInt(surahSelect.value);
                
                if (!surahNumber || isNaN(surahNumber)) {
                    showError('Silakan pilih surah terlebih dahulu');
                    return;
                }
                
                currentSurah = surahNumber;
                
                const surah = quranData[surahNumber];
                if (!surah) {
                    showError('Surah tidak ditemukan dalam database');
                    return;
                }

            // Update label tombol audio
                const audioBtn = document.querySelector('.audio-controls .audio-btn');
                if (audioBtn && quranData[currentSurah]) {
                    audioBtn.textContent = `â–¶ï¸ Putar Surah ${quranData[currentSurah].name}`;
                }

                const playBtn = document.getElementById('playAudioBtn');
                if (playBtn && quranData[currentSurah]) {
                    playBtn.disabled = false;
                    playBtn.textContent = `â–¶ï¸ Putar Surah ${quranData[currentSurah].name}`;
                }

                console.log('Loading surah:', surah.name);
                displaySurah(surah, surahNumber);
                updateStatistics();
                updateNavigation();
                closeAllPanels();
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                showNotification(`Surah ${surah.name} berhasil dimuat`);
            } catch (error) {
                console.error('Error loading surah:', error);
                showError('Terjadi kesalahan saat memuat surah');
            }
            updateNavigationButtons(); // Tambahkan baris ini!
        }

        // Display surah
        function displaySurah(surah, surahNumber) {
            try {
                const container = document.getElementById('surahContainer');
                if (!container) {
                    console.error('Surah container not found');
                    return;
                }
                
                let html = `
                    <div class="surah-header">
                        <h2>${surah.name} - ${surah.arabicName}</h2>
                        <p>Arti: ${surah.meaning} | Turun di: ${surah.revelation} | ${Object.keys(surah.verses).length} Ayat</p>
                    </div>
                `;

                Object.keys(surah.verses).forEach(verseNum => {
                    const verse = surah.verses[verseNum];
                    const isBookmarked = bookmarks.some(b => b.surah === surahNumber && b.verse === parseInt(verseNum));
                    
                    html += `
                        <div class="ayah-card" id="ayah-${surahNumber}-${verseNum}">
                            <div class="left-section">
                                <div class="ayah-number">Ayat ${verseNum}</div>
                                
                                ${currentSettings.showTransliteration ? `
                                    <div class="transliteration" style="display: block;">
                                        <h4>Transliterasi:</h4>
                                        <p>${verse.transliteration}</p>
                                    </div>
                                ` : `
                                    <div class="transliteration" style="display: none;">
                                        <h4>Transliterasi:</h4>
                                        <p>${verse.transliteration}</p>
                                    </div>
                                `}
                                
                                ${currentSettings.showTranslation ? `
                                    <div class="translation" style="display: block;">
                                        <h4>Terjemahan:</h4>
                                        <p>${verse.translation}</p>
                                    </div>
                                ` : `
                                    <div class="translation" style="display: none;">
                                        <h4>Terjemahan:</h4>
                                        <p>${verse.translation}</p>
                                    </div>
                                `}

                                <div class="verse-actions">
                                    <button class="action-btn bookmark-btn ${isBookmarked ? 'bookmarked' : ''}" 
                                            onclick="toggleBookmark(${surahNumber}, ${verseNum})">
                                        ${isBookmarked ? 'ğŸ”– Tersimpan' : 'ğŸ”– Simpan'}
                                    </button>
                                    <button class="action-btn" onclick="copyVerse(${surahNumber}, ${verseNum})">
                                        ğŸ“‹ Salin
                                    </button>
                                    <button class="action-btn" onclick="shareVerse(${surahNumber}, ${verseNum})">
                                        ğŸ“¤ Bagikan
                                    </button>
                                    <button class="action-btn" onclick="playVerseAudio(${surahNumber}, ${verseNum})">
                                        ğŸ”Š Audio
                                    </button>
                                </div>
                            </div>
                            
                            <div class="arabic-text">
                                <div class="arabic ${currentSettings.fontSize}-text" onclick="highlightVerse(${surahNumber}, ${verseNum})" data-surah="${surahNumber}" data-verse="${verseNum}">
                                    ${getArabicText(surahNumber, verseNum)}
                                </div>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
                console.log('Surah displayed successfully');
            } catch (error) {
                console.error('Error displaying surah:', error);
                showError('Terjadi kesalahan saat menampilkan surah');
            }

        }

        // Toggle theme
        function toggleTheme() {
            currentSettings.darkTheme = !currentSettings.darkTheme;
            document.body.classList.toggle('dark-theme');
            document.querySelector('.theme-toggle').textContent = currentSettings.darkTheme ? 'â˜€ï¸' : 'ğŸŒ™';
            saveSettings();
        }

        // Font size controls
        function setFontSize(size) {
            currentSettings.fontSize = size;
            document.querySelectorAll('.font-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick="setFontSize('${size}')"]`).classList.add('active');
            
            document.querySelectorAll('.arabic').forEach(el => {
                el.className = el.className.replace(/\b(small|medium|large|xlarge)-text\b/, '');
                el.classList.add(size + '-text');
            });
            
            saveSettings();
        }

        // Toggle transliteration
        function toggleTransliteration() {
            currentSettings.showTransliteration = !currentSettings.showTransliteration;
            document.getElementById('transliterationToggle').classList.toggle('active');
            
            document.querySelectorAll('.transliteration').forEach(el => {
                el.style.display = currentSettings.showTransliteration ? 'block' : 'none';
            });
            
            saveSettings();
        }

        // Toggle translation
        function toggleTranslation() {
            currentSettings.showTranslation = !currentSettings.showTranslation;
            document.getElementById('translationToggle').classList.toggle('active');
            
            document.querySelectorAll('.translation').forEach(el => {
                el.style.display = currentSettings.showTranslation ? 'block' : 'none';
            });
            
            saveSettings();
        }

        // Set language
        function setLanguage(lang) {
            currentSettings.language = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick="setLanguage('${lang}')"]`).classList.add('active');
            saveSettings();
            
            // Note: This would require multiple translation data
            // For now, we'll just save the setting
        }

        // Toggle settings panel
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            const overlay = document.getElementById('overlay');
            
            panel.classList.toggle('show');
            overlay.classList.toggle('show');
        }

        // Toggle search
        function toggleSearch() {
            const container = document.getElementById('searchContainer');
            container.classList.toggle('show');
            
            if (container.classList.contains('show')) {
                document.getElementById('searchInput').focus();
            }
        }

        // Search verse
        function searchVerse() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            if (!query) return;
            
            // Tampilkan loading
            const container = document.getElementById('surahContainer');
            container.innerHTML = '<div class="loading">Mencari ayat...</div>';

            // enter tutup kotak pencarian
            searchContainer.classList.remove('show');
            
            // Lakukan pencarian dengan delay kecil untuk UI responsif
            setTimeout(() => {
                searchResults = [];
                Object.keys(quranData).forEach(surahNum => {
                    const surah = quranData[surahNum];
                    Object.keys(surah.verses).forEach(verseNum => {
                        const verse = surah.verses[verseNum];
                        if (verse.translation.toLowerCase().includes(query) || 
                            verse.transliteration.toLowerCase().includes(query)) {
                            searchResults.push({
                                surah: parseInt(surahNum),
                                verse: parseInt(verseNum),
                                surahName: surah.name
                            });
                        }
                    });
                });
                
                displaySearchResults();
                
                // Auto-scroll ke hasil pencarian
                setTimeout(() => {
                    const surahContainer = document.getElementById('surahContainer');
                    if (surahContainer) {
                        surahContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100);
            }, 300);

            // Simpan dan tampilkan riwayat
            if (query) {
                searchHistory.unshift(query); // tambahkan ke depan
                // Hapus duplikat dan batasi hanya 5 item
                searchHistory = [...new Set(searchHistory)].slice(0, 5);
                console.log('Riwayat pencarian:', searchHistory);
            }

            // Bersihkan input dan tutup kotak pencarian
            document.getElementById('searchInput').value = '';
            document.getElementById('searchContainer').classList.remove('show');


            function addToSearchHistory(query) {
            if (!query) return;

            // Pastikan tidak duplikat
            const existingIndex = searchHistory.findIndex(item => item.text === query);
            if (existingIndex !== -1) {
                const existingItem = searchHistory.splice(existingIndex, 1)[0];
                searchHistory.unshift(existingItem); // Pindahkan ke atas
            } else {
                searchHistory.unshift({ text: query, pinned: false });
            }

            // Batasi riwayat (maks. 10 tanpa memotong pinned)
            const pinned = searchHistory.filter(h => h.pinned);
            const nonPinned = searchHistory.filter(h => !h.pinned).slice(0, 10 - pinned.length);
            searchHistory = [...pinned, ...nonPinned];

            localStorage.setItem('quranSearchHistory', JSON.stringify(searchHistory));
            renderSearchHistory();
        }
        }
        


        // Fungsi menampilkan hasil pencarian
        function displaySearchResults(results, append = false) {
            const container = document.getElementById('surahContainer');
            if (!append) container.innerHTML = '';

            if (!results || results.length === 0) {
                showError('Tidak ditemukan ayat yang cocok.');
                return;
            }

            results.forEach(result => {
                const verseData = quranData[result.surah].verses[result.verse];
                const html = `
                    <div class="ayah-card highlight">
                        <div class="left-section">
                            <div class="ayah-number">${result.surahName} - Ayat ${result.verse}</div>
                            <div class="transliteration"><p>${verseData.transliteration}</p></div>
                            <div class="translation"><p>${verseData.translation}</p></div>
                        </div>
                        <div class="arabic-text">
                            <div class="arabic ${currentSettings.fontSize}-text">
                                ${getArabicText(result.surah, result.verse)}
                            </div>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        // Display search results
        function displaySearchResults() {
            if (searchResults.length === 0) {
                showError('Tidak ada hasil pencarian');
                return;
            }
            
            const container = document.getElementById('surahContainer');
            let html = `
                <div class="surah-header">
                    <h2>ğŸ” Hasil Pencarian</h2>
                    <p>Ditemukan ${searchResults.length} ayat</p>
                </div>
            `;
            
            searchResults.forEach(result => {
                const verse = quranData[result.surah].verses[result.verse];
                const isBookmarked = bookmarks.some(b => b.surah === result.surah && b.verse === result.verse);
                
                html += `
                    <div class="ayah-card highlight" id="ayah-${result.surah}-${result.verse}">
                        <div class="left-section">
                            <div class="ayah-number">${result.surahName} - Ayat ${result.verse}</div>
                            <div class="transliteration">
                                <h4>Transliterasi:</h4>
                                <p>${verse.transliteration}</p>
                            </div>
                            <div class="translation">
                                <h4>Terjemahan:</h4>
                                <p>${verse.translation}</p>
                            </div>
                            <div class="verse-actions">
                                <button class="action-btn" onclick="goToVerse(${result.surah}, ${result.verse})">
                                    ğŸ“– Lihat Surah
                                </button>
                                <button class="action-btn bookmark-btn ${isBookmarked ? 'bookmarked' : ''}" 
                                        onclick="toggleBookmark(${result.surah}, ${result.verse})">
                                    ${isBookmarked ? 'ğŸ”– Tersimpan' : 'ğŸ”– Simpan'}
                                </button>
                            </div>
                        </div>
                        <div class="arabic-text">
                            <div class="arabic ${currentSettings.fontSize}-text">
                                ${verse.arabic}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Jangan langsung tutup search box, biarkan pengguna menutupnya manual
            // toggleSearch(); // Hapus atau comment baris ini
        }

    


        // Go to specific verse
        function goToVerse(surahNum, verseNum) {
            document.getElementById('surah').value = surahNum;
            currentSurah = surahNum;
            loadSurah();
            
            setTimeout(() => {
                const element = document.getElementById(`ayah-${surahNum}-${verseNum}`);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    element.classList.add('highlight');
                    setTimeout(() => element.classList.remove('highlight'), 3000);
                }
            }, 500);
        }

        // Bookmark functions
        function toggleBookmark(surahNum, verseNum) {
            const index = bookmarks.findIndex(b => b.surah === surahNum && b.verse === verseNum);
            
            if (index > -1) {
                bookmarks.splice(index, 1);
            } else {
                const surah = quranData[surahNum];
                bookmarks.push({
                    surah: surahNum,
                    verse: verseNum,
                    surahName: surah.name,
                    text: surah.verses[verseNum].translation
                });
            }
            
            localStorage.setItem('quranBookmarks', JSON.stringify(bookmarks));
            updateBookmarkCount();
            updateBookmarkButton(surahNum, verseNum);
            displayBookmarks();
        }

        function updateBookmarkButton(surahNum, verseNum) {
            const isBookmarked = bookmarks.some(b => b.surah === surahNum && b.verse === verseNum);
            const button = document.querySelector(`#ayah-${surahNum}-${verseNum} .bookmark-btn`);
            
            if (button) {
                button.classList.toggle('bookmarked', isBookmarked);
                button.textContent = isBookmarked ? 'ğŸ”– Tersimpan' : 'ğŸ”– Simpan';
            }
        }

        function toggleBookmarks() {
            const panel = document.getElementById('bookmarksPanel');
            const overlay = document.getElementById('overlay');
            
            panel.classList.toggle('open');
            overlay.classList.toggle('show');
            
            if (panel.classList.contains('open')) {
                displayBookmarks();
            }
        }

        function displayBookmarks() {
            const container = document.getElementById('bookmarksList');
            
            if (bookmarks.length === 0) {
                container.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">Belum ada bookmark</div>';
                return;
            }

            let html = '';
            bookmarks.forEach(bookmark => {
                html += `
                    <div class="bookmark-item" onclick="goToVerse(${bookmark.surah}, ${bookmark.verse})">
                        <h4>${bookmark.surahName} - Ayat ${bookmark.verse}</h4>
                        <p>${bookmark.text.substring(0, 100)}...</p>
                        <button onclick="event.stopPropagation(); removeBookmark(${bookmark.surah}, ${bookmark.verse})" 
                                style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; margin-top: 10px;">
                            ğŸ—‘ï¸ Hapus
                        </button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function removeBookmark(surahNum, verseNum) {
            toggleBookmark(surahNum, verseNum);
        }

        function updateBookmarkCount() {
            document.getElementById('bookmarkCount').textContent = bookmarks.length;
        }

        // Audio functions
        function playAudio() {
            if (!currentSurah || !quranData[currentSurah]) {
                showNotification("â— Silakan pilih surah terlebih dahulu.");
                return;
            }

            const surah = quranData[currentSurah];
            const ayatKeys = Object.keys(surah.verses).map(Number);
            autoPlayQueue = ayatKeys.map(n => ({ surah: currentSurah, ayah: n }));
            currentAutoIndex = 0;

            playNextInQueue();
        }

        function pauseAudio() {
            if (currentAudio) {
                currentAudio.pause();
            }
        }

        function stopAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
        }

        function getFormattedAyahNumber(surah, ayah) {
            return String(surah).padStart(3, '0') + String(ayah).padStart(3, '0');
        }

        function playVerseAudio(surahNum, verseNum) {
            const surah = quranData[surahNum];
            if (!surah || !surah.verses[verseNum]) {
                showNotification("âŒ Ayat tidak ditemukan.");
                return;
            }

            // Siapkan daftar semua ayat dari ayat sekarang ke akhir surah
            const ayatKeys = Object.keys(surah.verses).map(Number).filter(n => n >= verseNum);
            autoPlayQueue = ayatKeys.map(n => ({ surah: surahNum, ayah: n }));
            currentAutoIndex = 0;

            playNextInQueue();
        }

        function playNextInQueue() {
            if (currentAutoIndex >= autoPlayQueue.length) {
                showNotification("âœ… Semua ayat selesai diputar.");
                return;
            }

            const item = autoPlayQueue[currentAutoIndex];
            const surah = item.surah;
            const ayah = item.ayah;

            const qariMap = {
                'abdul-basit': 'AbdulBaset',
                'al-husary': 'Husary',
                'al-minshawi': 'Minshawi',
                'al-huzaifi': 'Hudzaifi',
                'aziz-alili': 'AzizAlili',
                'mishari-alafasy': 'Alafasy',
                'saad-al-ghamidi': 'SaadAlGhamdi',
                'saud-ash-shuraym': 'Shuraym'
            };

            const qariRaw = currentSettings.qari;
            const qari = qariMap[qariRaw] || 'AbdulBaset';

            const formattedNum = getFormattedAyahNumber(surah, ayah);
            const url = `https://verses.quran.com/${qari}/Mujawwad/mp3/${formattedNum}.mp3`;

            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }

            currentAudio = new Audio(url);
            currentAudio.play().then(() => {
                showNotification(`â–¶ï¸ Surah ${surah}, Ayat ${ayah}`);
            }).catch(() => {
                showNotification("âŒ Gagal memutar audio.");
            });

            currentAudio.onended = () => {
                currentAutoIndex++;
                playNextInQueue();
            };
        }



        // Utility functions
        function copyVerse(surahNum, verseNum) {
            const verse = quranData[surahNum].verses[verseNum];
            const text = `${verse.arabic}\n\n${verse.transliteration}\n\n${verse.translation}`;
            
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Ayat berhasil disalin!');
            });
        }

        function shareVerse(surahNum, verseNum) {
            const verse = quranData[surahNum].verses[verseNum];
            const surah = quranData[surahNum];
            const text = `${surah.name} - Ayat ${verseNum}\n\n${verse.arabic}\n\n${verse.translation}`;
            
            if (navigator.share) {
                navigator.share({
                    title: `${surah.name} - Ayat ${verseNum}`,
                    text: text
                });
            } else {
                copyVerse(surahNum, verseNum);
                showNotification('Ayat disalin, silakan bagikan secara manual');
            }
        }

        function highlightVerse(surahNum, verseNum) {
            const element = document.getElementById(`ayah-${surahNum}-${verseNum}`);
            element.classList.add('highlight');
            setTimeout(() => element.classList.remove('highlight'), 2000);
        }

        function showError(message) {
            document.getElementById('surahContainer').innerHTML = `
                <div class="error">
                    âŒ ${message}
                </div>
            `;
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4caf50;
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                z-index: 9999;
                animation: slideInRight 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Navigation functions
        function previousSurah() {
            if (currentSurah > 1) {
                currentSurah--;
                document.getElementById('surah').value = currentSurah;
                loadSurah();
            }
        }

        function nextSurah() {
            const maxSurah = Object.keys(quranData).length;
            if (currentSurah < maxSurah) {
                currentSurah++;
                document.getElementById('surah').value = currentSurah;
                loadSurah();
            }
        }

        function updateNavigation() {
            const maxSurah = Object.keys(quranData).length;
            document.getElementById('prevBtn').disabled = currentSurah <= 1;
            document.getElementById('nextBtn').disabled = currentSurah >= maxSurah;
        }

        // Statistics and progress
        function updateStatistics() {
            const surah = quranData[currentSurah];
            const totalVerses = Object.keys(surah.verses).length;
            
            document.getElementById('totalAyahs').textContent = totalVerses;
            
            // Simulate reading progress
            const progress = Math.floor(Math.random() * 100);
            document.getElementById('readingProgress').textContent = progress + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Scroll functions
        function setupScrollHandler() {
            window.addEventListener('scroll', () => {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const scrollBtn = document.getElementById('scrollTopBtn');
                
                if (scrollTop > 300) {
                    scrollBtn.style.display = 'block';
                } else {
                    scrollBtn.style.display = 'none';
                }
            });
        }

        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Close all panels
        function closeAllPanels() {
            document.getElementById('settingsPanel').classList.remove('show');
            document.getElementById('searchContainer').classList.remove('show');
            document.getElementById('bookmarksPanel').classList.remove('open');
            document.getElementById('overlay').classList.remove('show');
        }

        // Tambahkan highlight styling pada ayat hasil pencarian
        const style = document.createElement('style');
        style.innerHTML = `
            .ayah-card.highlight {
                border: 2px solid #00b894;
                background-color: #e8fff6;
            }
            body.dark-theme .ayah-card.highlight {
                border-color: #00cec9;
                background-color: #1e2b28;
            }
        `;
        document.head.appendChild(style);

        function updateNavigationButtons() {
          const prevBtn = document.getElementById('prevBtn');
          const nextBtn = document.getElementById('nextBtn');
          const surahSelect = document.getElementById('surah');
          const selectedSurah = surahSelect.value;

          // Hanya perbarui tombol jika ada surah yang dipilih
          if (selectedSurah) {
          const surahKeys = Object.keys(quranData);
          const currentSurahIndex = surahKeys.indexOf(selectedSurah);
          const prevSurahKey = surahKeys[currentSurahIndex - 1];
          const nextSurahKey = surahKeys[currentSurahIndex + 1];

          if (prevBtn) {
              prevBtn.textContent = prevSurahKey ? `â† ${quranData[prevSurahKey].name}` : 'â† Surah Pertama';
              prevBtn.disabled = !prevSurahKey;
          }
          if (nextBtn) {
              nextBtn.textContent = nextSurahKey ? `${quranData[nextSurahKey].name} â†’` : 'Surah Terakhir â†’';
              nextBtn.disabled = !nextSurahKey;
          }
        } else {
        // Jika tidak ada surah yang dipilih, atur teks dan status tombol ke default
        if (prevBtn) {
            prevBtn.textContent = 'â† Surah Sebelumnya';
            prevBtn.disabled = true;
        }
        if (nextBtn) {
            nextBtn.textContent = 'Surah Selanjutnya â†’';
            nextBtn.disabled = true;
        }
      }
      // Apply tajwid setting
      const tajwidToggle = document.getElementById('tajwidToggle');
        const tajwidLegend = document.getElementById('tajwidLegend');

        if (tajwidToggle) {
            tajwidToggle.classList.toggle('active', currentSettings.showTajwid);
        }
        if (tajwidLegend) {
            tajwidLegend.style.display = currentSettings.showTajwid ? 'grid' : 'none';
        }

        // Update tampilan teks jika sudah ada surah yang dimuat
        updateArabicTextDisplay();
    }
    </script>
</body>
</html>